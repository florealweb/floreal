<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel de Control – FLOREAL</title>

  <!-- Tipografías -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">

  <style>
    :root{
      --fondo: #f8f7f2;
      --blanco: #ffffff;
      --texto: #1a1a1a;
      --burdeos: #6e1e24;
      --gris: #d8d6d0;
      --radio: 10px;
      --sombra: 0 6px 22px rgba(0,0,0,0.08);
      --gap: 1.25rem;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Merriweather', serif;
      background: var(--fondo);
      color: var(--texto);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding: 1.5rem;
    }

    /* Cabecera */
    header{
      background: var(--burdeos);
      color: var(--blanco);
      padding: 1rem 1.5rem;
      border-radius: 12px;
      box-shadow: var(--sombra);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:1rem;
      margin-bottom:1.25rem;
    }
    header .brand{
      font-family: 'Playfair Display', serif;
      font-size:1.6rem;
      letter-spacing:2px;
      text-transform:uppercase;
    }
    header .sub {
      font-size:0.9rem;
      opacity:0.9;
    }
    header .actions {
      display:flex;
      gap:0.5rem;
      align-items:center;
    }
    .btn {
      background:var(--burdeos);
      color:var(--blanco);
      padding:0.55rem 0.9rem;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-family: 'Merriweather', serif;
    }
    .btn.ghost {
      background:transparent;
      border:1px solid rgba(255,255,255,0.15);
    }

    /* Layout */
    .container{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:var(--gap);
      align-items:start;
    }

    /* Tarjeta del formulario */
    .card {
      background:var(--blanco);
      padding:1.2rem;
      border-radius: var(--radio);
      box-shadow: var(--sombra);
      border:1px solid var(--gris);
    }
    .card h2{
      margin:0 0 0.8rem 0;
      font-family: 'Playfair Display', serif;
      color:var(--burdeos);
      text-transform:uppercase;
      font-size:1.05rem;
    }
    label{
      display:block;
      font-weight:700;
      margin-top:0.8rem;
      font-size:0.95rem;
    }
    input[type="text"], input[type="date"], select, textarea {
      width:100%;
      padding:0.6rem;
      margin-top:0.4rem;
      border-radius:8px;
      border:1px solid var(--gris);
      font-family: inherit;
      font-size:0.98rem;
      background:transparent;
    }
    textarea { min-height:180px; resize:vertical; }

    .file-row{
      display:flex;
      gap:0.6rem;
      align-items:center;
      margin-top:0.5rem;
    }
    .small {
      font-size:0.9rem; color:#666;
    }

    .controls{
      margin-top:1rem;
      display:flex;
      gap:0.6rem;
      flex-wrap:wrap;
    }

    /* Previsualización tipo artículo */
    .preview-wrap {
      position:relative;
    }
    .preview {
      background:var(--blanco);
      padding:1.5rem;
      border-radius:12px;
      box-shadow: var(--sombra);
      border:1px solid var(--gris);
    }
    .masthead {
      text-align:center;
      margin-bottom:0.6rem;
    }
    .masthead .title {
      font-family: 'Playfair Display', serif;
      font-size:2.2rem;
      letter-spacing: 4px;
      text-transform:uppercase;
      margin:0;
      color:var(--texto);
    }
    .meta {
      text-align:center;
      color:#666;
      font-size:0.9rem;
      margin-bottom:0.8rem;
    }
    .hero {
      width:100%;
      height:auto;
      border-radius:8px;
      overflow:hidden;
      margin-bottom:0.8rem;
    }
    .hero img { width:100%; display:block; }

    .article-body {
      line-height:1.85;
      font-size:1.02rem;
      color:var(--texto);
    }

    /* Mobile */
    @media (max-width:980px){
      .container{ grid-template-columns: 1fr; }
      header{ flex-direction:column; align-items:flex-start; gap:0.6rem; }
    }

    /* pequeñas utilidades */
    .muted{ color:#777; font-size:0.9rem }
    .input-inline { display:flex; gap:0.6rem; align-items:center; }
  </style>
</head>
<body>
  <header>
    <div>
      <div class="brand">FLOREAL</div>
      <div class="sub">Panel de redacción — privado</div>
    </div>

    <div class="actions">
      <a class="btn ghost" href="../index.html" title="Volver a la portada">Volver</a>
      <button class="btn" id="downloadBtn" title="Generar y descargar HTML">Generar & Descargar</button>
      <button class="btn" id="copyBtn" title="Copiar HTML al portapapeles">Copiar HTML</button>
    </div>
  </header>

  <div class="container">
    <!-- FORM -->
    <section class="card" aria-labelledby="formTitle">
      <h2 id="formTitle">Crear artículo</h2>

      <label for="titulo">Título (mayúsculas)</label>
      <input id="titulo" type="text" placeholder="TÍTULO DEL ARTÍCULO">

      <label for="subtitulo">Subtítulo (opcional)</label>
      <input id="subtitulo" type="text" placeholder="Subtítulo breve">

      <div class="input-inline">
        <div style="flex:1">
          <label for="fecha">Fecha</label>
          <input id="fecha" type="date">
        </div>
        <div style="width:140px">
          <label for="categoria">Categoría</label>
          <select id="categoria">
            <option value="actualidad">Actualidad</option>
            <option value="cultura">Cultura</option>
            <option value="opinion">Opinión</option>
          </select>
        </div>
      </div>

      <label for="imagen">Imagen destacada</label>
      <div class="file-row">
        <input id="imagen" type="file" accept="image/*">
        <div class="small muted">JPG/PNG/GIF (máx. 5 MB)</div>
      </div>

      <label for="contenido">Cuerpo del artículo</label>
      <textarea id="contenido" placeholder="Escribe el texto del artículo aquí..."></textarea>

      <div class="controls">
        <button class="btn" id="previewBtn">Vista previa</button>
        <button class="btn" id="clearBtn" type="button">Limpiar</button>
      </div>

      <p class="muted" style="margin-top:0.8rem">Sugerencia: escribe párrafos separados por una línea en blanco. El botón "Generar & Descargar" creará un archivo HTML con el estilo FLOREAL listo para publicar.</p>
    </section>

    <!-- PREVIEW -->
    <aside class="preview-wrap">
      <div class="preview" id="preview">
        <div class="masthead">
          <div class="title">FLOREAL</div>
        </div>
        <div class="meta" id="meta">—</div>
        <div class="hero" id="heroPlaceholder" style="display:none;"><img id="heroImg" alt="Imagen destacada"></div>
        <h2 id="previewTitle" style="font-family:'Playfair Display',serif;text-transform:uppercase;margin:0 0 6px 0;"></h2>
        <h3 id="previewSub" style="margin:0 0 12px 0;color:#444;font-weight:400;font-family:'Merriweather',serif;"></h3>
        <div class="article-body" id="previewBody"><p class="muted">Pulsa "Vista previa" para ver el artículo aquí.</p></div>
      </div>
    </aside>
  </div>

  <script>
    // Elementos
    const tituloEl = document.getElementById('titulo');
    const subtituloEl = document.getElementById('subtitulo');
    const fechaEl = document.getElementById('fecha');
    const categoriaEl = document.getElementById('categoria');
    const contenidoEl = document.getElementById('contenido');
    const imagenEl = document.getElementById('imagen');

    const previewTitle = document.getElementById('previewTitle');
    const previewSub = document.getElementById('previewSub');
    const previewBody = document.getElementById('previewBody');
    const meta = document.getElementById('meta');
    const heroPlaceholder = document.getElementById('heroPlaceholder');
    const heroImg = document.getElementById('heroImg');

    const previewBtn = document.getElementById('previewBtn');
    const clearBtn = document.getElementById('clearBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyBtn = document.getElementById('copyBtn');

    let imagenBase64 = '';

    // Image -> base64 preview
    imagenEl.addEventListener('change', () => {
      const file = imagenEl.files[0];
      if (!file) { imagenBase64 = ''; heroPlaceholder.style.display='none'; return; }
      if (file.size > 5 * 1024 * 1024) { alert('La imagen supera los 5 MB. Elige otra.'); imagenEl.value=''; return; }
      const reader = new FileReader();
      reader.onload = e => {
        imagenBase64 = e.target.result;
        heroImg.src = imagenBase64;
        heroPlaceholder.style.display = 'block';
      };
      reader.readAsDataURL(file);
    });

    // Generar vista previa
    previewBtn.addEventListener('click', () => renderPreview());

    // Limpiar formulario
    clearBtn.addEventListener('click', () => {
      tituloEl.value = ''; subtituloEl.value=''; fechaEl.value=''; categoriaEl.value='actualidad'; contenidoEl.value=''; imagenEl.value=''; imagenBase64=''; heroPlaceholder.style.display='none';
      previewTitle.textContent=''; previewSub.textContent=''; previewBody.innerHTML='<p class="muted">Pulsa "Vista previa" para ver el artículo aquí.</p>'; meta.textContent='—';
    });

    function renderPreview(){
      const titulo = tituloEl.value.trim() || 'TÍTULO SIN DEFINIR';
      const subt = subtituloEl.value.trim();
      const fecha = fechaEl.value ? new Date(fechaEl.value).toLocaleDateString('es-ES', {day:'numeric', month:'long', year:'numeric'}) : '';
      const categoria = categoriaEl.value;
      const contenido = contenidoEl.value.trim();

      previewTitle.textContent = titulo.toUpperCase();
      previewSub.textContent = subt;
      meta.textContent = `${fecha} · ${categoria}`;
      previewBody.innerHTML = contenido ? contenido.split(/\n\s*\n/).map(p => `<p>${escapeHtml(p).replace(/\n/g,'<br>')}</p>`).join('') : '<p class="muted">Sin contenido</p>';

      if (imagenBase64) { heroImg.src = imagenBase64; heroPlaceholder.style.display = 'block'; } else { heroPlaceholder.style.display='none'; }
      // Auto-scroll preview on small screens
      if (window.innerWidth < 700) { window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'}); }
    }

    // Escape sencillo para evitar inyección
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    // Generar HTML final con estilo básico (en línea para ser portable)
    function buildArticleHtml(){
      const titulo = tituloEl.value.trim() || 'TÍTULO';
      const subt = subtituloEl.value.trim();
      const fecha = fechaEl.value ? new Date(fechaEl.value).toLocaleDateString('es-ES', {day:'numeric', month:'long', year:'numeric'}) : '';
      const categoria = categoriaEl.value;
      const contenido = contenidoEl.value.trim();
      const bodyHtml = contenido ? contenido.split(/\n\s*\n/).map(p => `<p>${escapeHtml(p).replace(/\n/g,'<br>')}</p>`).join('') : '<p></p>';
      // small inline stylesheet to preserve FLOREAL look when descargado
      const cssInline = `
        body{font-family: 'Merriweather', serif; background:#f8f7f2; color:#1a1a1a; padding:32px;}
        .container{max-width:820px;margin:0 auto;background:#fff;padding:28px;border-radius:8px;border:1px solid #e6e4df;}
        .mast{ text-align:center; margin-bottom:12px; }
        .mast h1{ font-family:'Playfair Display', serif; font-size:36px; letter-spacing:4px; text-transform:uppercase; margin:0; }
        .meta{ text-align:center; color:#666; margin-bottom:16px; }
        .hero img{ width:100%; border-radius:6px; }
        .article-body{ line-height:1.8; font-size:18px; color:#111; }
      `;
      const imgTag = imagenBase64 ? `<div class="hero"><img src="${imagenBase64}" alt="${escapeHtml(titulo)}"></div>` : '';
      const html = `<!doctype html>
<html lang="es"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${escapeHtml(titulo)}</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Merriweather&display=swap" rel="stylesheet">
<style>${cssInline}</style></head><body>
<div class="container">
  <div class="mast"><h1>${escapeHtml(titulo).toUpperCase()}</h1></div>
  <div class="meta">${escapeHtml(fecha)} · ${escapeHtml(categoria)}</div>
  ${imgTag}
  <div class="article-body">${bodyHtml}</div>
</div></body></html>`;
      return html;
    }

    // Descargar archivo HTML
    downloadBtn.addEventListener('click', () => {
      const html = buildArticleHtml();
      const filename = slugify((tituloEl.value || 'articulo').substring(0,60)) + '.html';
      const blob = new Blob([html], {type:'text/html;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);
    });

    // Copiar HTML al portapapeles
    copyBtn.addEventListener('click', async () => {
      const html = buildArticleHtml();
      try {
        await navigator.clipboard.writeText(html);
        copyBtn.textContent = 'Copiado ✓';
        setTimeout(()=> copyBtn.textContent = 'Copiar HTML', 1800);
      } catch (e) {
        alert('No se pudo copiar automáticamente. Usa Descargar o selecciona y copia manualmente.');
      }
    });

    // slugify simple para nombre de archivo
    function slugify(text){
      return text.toString().toLowerCase()
        .replace(/\s+/g,'-')
        .replace(/[^\w\-]+/g,'')
        .replace(/\-\-+/g,'-')
        .replace(/^-+/, '')
        .replace(/-+$/, '');
    }

    // Soporte teclado (Ctrl+Enter para vista previa)
    document.addEventListener('keydown', e => {
      if (e.ctrlKey && e.key === 'Enter') { e.preventDefault(); renderPreview(); }
    });
  </script>
</body>
</html>
